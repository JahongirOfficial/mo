#!/bin/bash

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ"
echo "======================================================"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:"
echo "--------------------------------"
sudo nginx -T 2>/dev/null | grep -A 5 "client_max_body_size"
echo ""

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–∫–∏ uploads
echo "2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–∫–∏ uploads:"
echo "--------------------------"
if [ -d "/var/www/moo/uploads" ]; then
    echo "‚úÖ –ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    ls -lah /var/www/moo/uploads | head -10
    echo ""
    echo "–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:"
    ls -ld /var/www/moo/uploads
    echo ""
    echo "–í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å–∞ Node.js:"
    ps aux | grep "node.*3001" | grep -v grep
else
    echo "‚ùå –ü–∞–ø–∫–∞ /var/www/moo/uploads –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
fi
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ nginx
echo "3Ô∏è‚É£ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ nginx:"
echo "--------------------------"
sudo tail -20 /var/log/nginx/error.log
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "4Ô∏è‚É£ –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (PM2):"
echo "-------------------------"
pm2 logs moo --lines 30 --nostream
echo ""

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL:"
echo "----------------"
echo | openssl s_client -connect mukammalotaona.uz:443 -servername mukammalotaona.uz 2>/dev/null | grep -E "subject=|issuer=|Verify return code"
echo ""

# 6. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ curl
echo "6Ô∏è‚É£ –¢–µ—Å—Ç API endpoint:"
echo "---------------------"
TOKEN="YOUR_ADMIN_TOKEN_HERE"
echo "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª:"
echo "curl -X POST https://mukammalotaona.uz/api/upload/video \\"
echo "  -H 'Authorization: Bearer \$TOKEN' \\"
echo "  -F 'video=@test.mp4'"
echo ""

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
echo "7Ô∏è‚É£ –î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ:"
echo "-------------------------"
df -h /var/www/moo
echo ""

# 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ Node.js
echo "8Ô∏è‚É£ –°—Ç–∞—Ç—É—Å Node.js –ø—Ä–æ—Ü–µ—Å—Å–∞:"
echo "---------------------------"
pm2 status
echo ""

echo "======================================================"
echo "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
echo ""
echo "üìã –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:"
echo "   1. client_max_body_size –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 500M"
echo "   2. –ü–∞–ø–∫–∞ uploads –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø—Ä–∞–≤–∞–º–∏ 755"
echo "   3. –í –ª–æ–≥–∞—Ö –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ 413 –∏–ª–∏ 502"
echo "   4. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º"
echo "   5. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ"
echo ""
